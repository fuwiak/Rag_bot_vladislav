# Руководство пользователя RAG Bot Admin

Это руководство поможет вам управлять системой Telegram-ботов для работы с документами.

## Содержание

1. [Создание нового проекта/отдела](#создание-нового-проектаотдела)
2. [Загрузка документов](#загрузка-документов)
3. [Привязка Telegram-бота](#привязка-telegram-бота)
4. [Управление доступом сотрудников](#управление-доступом-сотрудников)
5. [Настройка промпта для проекта](#настройка-промпта-для-проекта)
6. [Управление моделями LLM](#управление-моделями-llm)

---

## Создание нового проекта/отдела

1. Войдите в админ-панель
2. Перейдите в раздел **"Проекты"** в боковом меню
3. Нажмите кнопку **"Создать новый проект"**
4. Заполните форму:
   - **Название проекта** - название вашего отдела/проекта
   - **Описание** (опционально) - краткое описание проекта
   - **Пароль доступа** - пароль, который сотрудники будут использовать для входа в бота
   - **Токен Telegram бота** (опционально) - можно добавить позже
   - **Шаблон промпта** - инструкция для нейросети (см. раздел "Настройка промпта")
   - **Максимальная длина ответа** - максимальное количество символов в ответе (100-10000)
5. Нажмите **"Создать проект"**

**Результат:** Создан новый проект, готовый для загрузки документов и настройки бота.

---

## Загрузка документов

1. Откройте проект, в который хотите загрузить документы
2. Перейдите на вкладку **"Документы"**
3. Нажмите кнопку **"Загрузить документы"**
4. Выберите файлы (поддерживаются форматы: `.txt`, `.docx`, `.pdf`)
5. Нажмите **"Загрузить"**

**Важно:**
- Можно загружать несколько файлов одновременно
- Обработка документов происходит в фоновом режиме
- После загрузки документы автоматически разбиваются на части (чанки) и индексируются
- Это может занять некоторое время в зависимости от размера документов

**Удаление документа:**
- Нажмите кнопку **"Удалить"** рядом с нужным документом
- Документ и все связанные данные будут удалены

---

## Привязка Telegram-бота

### Шаг 1: Создание бота в Telegram

1. Откройте Telegram и найдите бота [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям:
   - Введите имя бота (отображается в списке контактов)
   - Введите username бота (должен заканчиваться на `bot`, например: `my_department_bot`)
4. **Сохраните токен бота** - он понадобится на следующем шаге

### Шаг 2: Привязка бота к проекту

**Вариант 1: При создании проекта**
- Введите токен в поле **"Токен Telegram бота"** при создании проекта

**Вариант 2: В существующем проекте**
1. Откройте проект
2. Перейдите на вкладку **"Настройки"**
3. В разделе **"Telegram бот"** нажмите **"Добавить/Изменить токен"**
4. Введите токен бота
5. Нажмите **"Проверить и сохранить"**

**Результат:** Бот автоматически запустится бот-сервисом в течение 20 секунд.

**Проверка работы бота:**
- Перейдите в раздел **"Telegram боты"** в боковом меню
- Найдите ваш проект в списке
- Статус должен быть **"Активен"**
- Нажмите на ссылку бота для открытия в Telegram

---

## Управление доступом сотрудников

### Настройка пароля доступа

1. Откройте проект
2. Перейдите на вкладку **"Настройки"**
3. В поле **"Пароль доступа"** введите новый пароль
4. Нажмите **"Сохранить"**

**Важно:** Один пароль для всех сотрудников проекта. Сообщите пароль сотрудникам.

### Просмотр списка пользователей

1. Перейдите в раздел **"Пользователи"** в боковом меню
2. Вы увидите список всех пользователей всех проектов
3. Для каждого пользователя отображается:
   - Номер телефона
   - Username (если есть)
   - Проект
   - Статус (Активен/Заблокирован)
   - Дата создания

### Блокировка/разблокировка пользователя

1. В списке пользователей нажмите на статус пользователя
2. Статус изменится (Активен ↔ Заблокирован)
3. Заблокированные пользователи не смогут использовать бота

### Добавление пользователя вручную

1. В разделе **"Пользователи"** нажмите **"Добавить пользователя"**
2. Выберите проект
3. Введите номер телефона
4. Введите username (опционально)
5. Нажмите **"Добавить"**

**Примечание:** Обычно пользователи добавляются автоматически при первом входе в бота.

---

## Настройка промпта для проекта

Промпт - это инструкция для нейросети, которая определяет, как бот должен отвечать на вопросы.

### Доступные плейсхолдеры

- `{chunks}` - контекст из документов (релевантные фрагменты)
- `{question}` - вопрос пользователя
- `{max_length}` - максимальная длина ответа

### Пример хорошего промпта

```
Ты помощник, который отвечает на вопросы строго на основе предоставленных документов.

Контекст из документов:
{chunks}

Вопрос пользователя: {question}

Правила:
1. Отвечай ТОЛЬКО на основе предоставленного контекста
2. Если информации нет в контексте, скажи: "В загруженных документах нет информации по этому вопросу"
3. Будь кратким и структурированным
4. Максимальная длина ответа: {max_length} символов
5. Если возможно, укажи из какого раздела документа информация

Ответ:
```

### Как изменить промпт

1. Откройте проект
2. Перейдите на вкладку **"Настройки"**
3. Найдите поле **"Шаблон промпта"**
4. Отредактируйте текст
5. Нажмите **"Сохранить"**

**Важно:**
- Промпт должен содержать все три плейсхолдера: `{chunks}`, `{question}`, `{max_length}`
- Бот будет отвечать строго на основе документов - не додумывать информацию
- Изменения применяются сразу для новых вопросов

---

## Управление моделями LLM

Система использует модели LLM для генерации ответов. Вы можете настроить модели для каждого проекта отдельно или использовать глобальные настройки.

### Глобальные настройки моделей

1. Перейдите в раздел **"Модели"** в боковом меню
2. В разделе **"Глобальные настройки моделей"**:
   - **Primary модель** - основная модель (используется по умолчанию)
   - **Fallback модель** - резервная модель (используется если primary недоступна)
3. Введите название модели в поле поиска и выберите из списка
4. Настройки сохраняются автоматически

### Настройка модели для проекта

1. Откройте проект
2. Перейдите на вкладку **"Настройки"**
3. В разделе **"Модель LLM"** выберите модель из списка
4. Нажмите **"Сохранить"**

**Примечание:** Если для проекта не выбрана модель, используется глобальная Primary модель.

### Добавление кастомной модели

1. В разделе **"Модели"** нажмите **"+ Добавить кастомную модель"**
2. Заполните форму:
   - **ID модели** - ID модели из OpenRouter (например: `custom/my-model`)
   - **Название** - понятное название модели
   - **Описание** (опционально)
3. Нажмите **"Добавить"**

---

## Часто задаваемые вопросы

### Как сотрудник использует бота?

1. Сотрудник открывает бота в Telegram
2. Бот просит ввести пароль доступа
3. После ввода пароля бот просит поделиться номером телефона
4. После авторизации сотрудник может задавать вопросы боту
5. Бот отвечает на основе загруженных документов

### Что делать, если бот не отвечает?

1. Проверьте статус бота в разделе **"Telegram боты"**
2. Убедитесь, что у проекта есть токен бота
3. Проверьте, что в проекте загружены документы
4. Попробуйте перезапустить бота (удалить и добавить токен заново)

### Как изменить пароль доступа?

1. Откройте проект → вкладка **"Настройки"**
2. Измените **"Пароль доступа"**
3. Сообщите новый пароль сотрудникам

### Можно ли использовать один бот для нескольких проектов?

Да, можно привязать один токен бота к нескольким проектам. В этом случае при входе в бота пользователь должен будет ввести пароль своего проекта.

### Как сделать резервную копию данных?

Используйте скрипт резервного копирования:

```bash
# Для SQLite
python backend/backup_database.py backup

# Для PostgreSQL
python backend/backup_database.py backup
```

Бэкап сохраняется в директории `backups/`.

### Как восстановить данные из бэкапа?

```bash
python backend/backup_database.py restore <путь_к_файлу_бэкапа>
```

**Внимание:** Восстановление перезапишет текущие данные!

---

## Поддержка

Если у вас возникли вопросы или проблемы:
1. Проверьте этот раздел FAQ
2. Обратитесь к администратору системы
3. Проверьте логи в разделе мониторинга (если доступен)

---

**Версия документа:** 1.0  
**Дата обновления:** 2024













