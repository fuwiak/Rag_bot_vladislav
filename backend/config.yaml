# Конфигурация промптов и констант для RAG системы

prompts:
  # Дефолтный шаблон промпта
  default_template: |
    Ты помощник, который отвечает на вопросы пользователя.

    Контекст из документов (если доступен):
    {chunks}

    Вопрос пользователя: {question}

    Правила:
    1. Если есть контекст из документов, отвечай в первую очередь на его основе
    2. Если контекста нет или информации недостаточно, можешь использовать свои знания, но укажи это
    3. Будь кратким и структурированным
    4. Максимальная длина ответа: {max_length} символов
    5. Если используешь информацию из документов, укажи это

    Ответ:

  # Системные промпты для разных сценариев
  system:
    # Базовый ассистент
    basic_assistant: "Ты - полезный ассистент, который отвечает на вопросы пользователей. Отвечай на русском языке, будь дружелюбным и информативным."
    
    # Ассистент с документами
    document_assistant: "Ты - полезный ассистент, который отвечает на вопросы пользователей на основе предоставленных документов. Отвечай на русском языке, будь дружелюбным и информативным."
    
    # Ассистент с метаданными
    metadata_assistant: "Ты - полезный ассистент, который отвечает на вопросы пользователей на основе информации о загруженных документах. Отвечай на русском языке, будь дружелюбным и информативным. Используй названия файлов и ключевые слова для создания описаний."
    
    # Агрессивный fallback ассистент
    aggressive_fallback: "Ты - полезный ассистент, который всегда находит способ ответить на вопросы пользователей. Используй любую доступную информацию: названия файлов, ключевые слова, метаданные, частичное содержимое. Отвечай на русском языке, будь дружелюбным и информативным. НИКОГДА не говори 'нет информации' - всегда можно дать полезный ответ на основе доступных данных."
    
    # Sub-agent для целых документов
    sub_agent: "Ты - sub-agent, который анализирует целые документы для ответа на вопросы. Отвечай кратко и по делу."
    
    # Late chunking ассистент
    late_chunking: "Ты - ассистент, который отвечает на вопросы на основе документов. Отвечай кратко и информативно."
    
    # Генератор вопросов
    question_generator: "Ты помощник, который генерирует вопросы на основе документов."
    
    # Переформулировщик вопросов
    question_reformulator: "Ты помощник, который переформулирует вопросы для лучшего поиска информации."
    
    # Генератор дополнительных вопросов
    additional_questions_generator: "Ты помощник, который генерирует дополнительные вопросы для улучшения поиска информации."
    
    # Генератор summaries
    summary_generator: "Ты помощник, который создает краткие содержания документов. Отвечай только summary, без дополнительных комментариев."
    
    # NLP-enhanced ассистент
    nlp_expert: |
      Ты - эксперт по анализу документов, использующий NLP техники для глубокого понимания содержания. 
      Ты анализируешь документы целиком, выделяя ключевые концепции, сущности и связи между ними.
      Отвечай на русском языке, будь точным и информативным.
    
    # NLP-enhanced с минимальным контекстом
    nlp_minimal_context: |
      Ты - полезный ассистент, который отвечает на вопросы пользователей. 
      Даже если у тебя нет полного содержимого документа, используй название файла и общие знания для ответа.
      Отвечай на русском языке, будь дружелюбным и информативным.

  # Промпты для контентных вопросов
  content_question:
    metadata_only: |
      Информация о загруженных документах:

      {metadata_context}

      ИНСТРУКЦИЯ: На основе этой информации ответь на вопрос пользователя. 
      - Если вопрос о summary каждого файла, создай краткое описание каждого файла на основе его названия и ключевых слов
      - Используй названия файлов и ключевые слова для понимания содержания
      - Будь конкретным и информативным
    
    with_chunks: |
      На основе следующих фрагментов документов ответь на вопрос пользователя.
      Если ответа нет в контексте, так и скажи.

      КОНТЕКСТ:
      {context}

      ВОПРОС: {question}

      ОТВЕТ:

  # Промпты для метаданных
  metadata:
    prompt: |
      Метаданные документов:

      {metadata_context}

      ВАЖНО: Используй эту информацию для ответа на вопрос. Если вопрос касается конкретного файла, используй название файла и ключевые слова из метаданных.
    
    user_prompt: |
      Вопрос пользователя: {question}

      Используй информацию о документах выше для ответа.

      Ответ:

  # Промпты для fallback стратегий
  fallback:
    document_summary: |
      На основе информации о загруженных документах ответь на вопрос пользователя.
      Используй ВСЮ доступную информацию: названия файлов, ключевые слова, метаданные, и даже частичное содержимое.

      ИНФОРМАЦИЯ О ДОКУМЕНТАХ:
      {metadata_context}
      {additional_content}

      ВОПРОС ПОЛЬЗОВАТЕЛЯ: {question}

      ИНСТРУКЦИЯ:
      - Используй названия файлов для понимания тематики документов
      - Используй ключевые слова для определения содержания
      - Если есть частичное содержимое, используй его для более точного ответа
      - Создай информативный ответ на основе всех доступных данных
      - НЕ говори "нет информации" - всегда можно дать ответ на основе метаданных и названий файлов
      - Будь конкретным и информативным

      ОТВЕТ:
    
    ai_agent: |
      Вопрос пользователя: {question}

      Используй свои знания и контекст проекта '{project_name}' для ответа на вопрос.
      Будь полезным и информативным, даже если у тебя нет доступа к конкретным документам.

      Ответ:
    
    sub_agent: |
      Вопрос пользователя: {question}

      Полный документ '{filename}':
      {content}

      Ответь на вопрос на основе этого документа. Если информации нет, так и скажи.
    
    late_chunking: |
      Вопрос пользователя: {question}

      Документ '{filename}' (релевантность: {score:.2f}):
      {content}

      Ответь на вопрос на основе этого документа.
    
    general_knowledge: |
      На основе названия документа '{filename}' и вопроса пользователя, 
      попробуй дать полезный ответ, используя общие знания о теме документа.

      ВОПРОС: {question}

      ИНСТРУКЦИЯ: 
      - Используй название файла для понимания тематики
      - Дай информативный ответ на основе общих знаний
      - Если не можешь ответить точно, дай общий ответ по теме
      - Будь полезным и информативным

      ОТВЕТ:

  # Промпты для NLP-enhanced summarization
  nlp_summarization:
    full_content: |
      Ты - эксперт по анализу документов с использованием NLP техник.

      ДОКУМЕНТ: {filename}

      СОДЕРЖАНИЕ ДОКУМЕНТА:
      {content}

      {summary_part}ВОПРОС ПОЛЬЗОВАТЕЛЯ: {question}

      ИНСТРУКЦИИ (NLP-Enhanced подход):
      1. Проанализируй вопрос и определи ключевые концепции: {keywords}
      2. Найди релевантные части документа, которые отвечают на вопрос
      3. Используй весь контекст документа для полного понимания
      4. Если вопрос касается конкретной информации, найди точные данные в документе
      5. Если вопрос общий, создай структурированный ответ на основе всего документа
      6. Выдели ключевые факты, цифры, даты, имена, если они есть в документе
      7. Будь точным и информативным, используй информацию из документа

      ОТВЕТ (на русском языке, структурированный и информативный):
    
    minimal_context: |
      Ты - полезный ассистент, который отвечает на вопросы пользователей.

      ИНФОРМАЦИЯ О ДОКУМЕНТЕ:
      {content}
      {summary_part}

      ВАЖНО: Полное содержимое документа еще обрабатывается, но у тебя есть информация о документе выше.

      ВОПРОС ПОЛЬЗОВАТЕЛЯ: {question}

      ИНСТРУКЦИИ:
      1. Используй название файла и доступную информацию для понимания тематики документа
      2. На основе названия файла и ключевых слов (если есть) попробуй понять, о чем документ
      3. Используй общие знания по теме документа для ответа на вопрос
      4. Будь информативным и полезным, даже если у тебя нет полного содержимого
      5. Если можешь дать общий ответ по теме на основе названия файла - сделай это
      6. Будь честным: если нужна конкретная информация из документа, скажи об этом

      ОТВЕТ (на русском языке, информативный и полезный):

  # Промпты для генерации предложенных вопросов
  suggested_questions:
    prompt: |
      На основе следующего контекста из документов, сгенерируй {limit} интересных и полезных вопросов, которые можно задать об этом содержимом.

      Контекст из документов:
      {context}

      Требования к вопросам:
      1. Вопросы должны быть конкретными и релевантными содержимому
      2. Вопросы должны быть на русском языке
      3. Вопросы должны быть разными по тематике
      4. Каждый вопрос должен быть на отдельной строке
      5. Не используй нумерацию или маркеры

      Сгенерируй только вопросы, без дополнительных комментариев:

# Константы и сообщения об ошибках
constants:
  # Сообщения об ошибках
  errors:
    user_not_found: "Пользователь не найден"
    project_not_found: "Проект не найден"
    processing_error: "Извините, произошла ошибка при обработке вашего вопроса. Пожалуйста, попробуйте переформулировать вопрос или обратитесь к администратору."
    analysis_error: "Извините, произошла ошибка при анализе документа. Пожалуйста, попробуйте переформулировать вопрос."
    no_information: "В загруженных документах нет информации по этому вопросу."
    no_documents: "В проекте нет документов для анализа."
    project_error: "Извините, произошла ошибка при обработке вашего вопроса в проекте '{project_name}'. Пожалуйста, попробуйте переформулировать вопрос."
    no_documents_loaded: "В проекте '{project_name}' пока нет загруженных документов. Пожалуйста, загрузите документы, чтобы я мог ответить на ваши вопросы."
    documents_processing: "Документы еще обрабатываются. Доступна только информация о загруженных файлах."
    documents_processing_metadata: "На основе доступной информации о документах:\n\n{metadata_context}\n\nК сожалению, полное содержимое документов еще обрабатывается, но вы можете задать вопросы о конкретных файлах по их названиям."
  
  # Фразы отказа от ответа
  refusal_phrases:
    - "нет информации"
    - "не могу ответить"
    - "не нашел"
    - "не найдено"
    - "нет данных"
    - "недостаточно информации"
    - "нет релевантной информации"
    - "не удалось найти"
  
  # Статусы обработки документов
  document_status:
    processing: "Обработка..."
    processed: "Обработан"
  
  # Сообщения для быстрого ответа
  fast_response:
    short_answer: "Отвечай кратко, не более 500 символов."
    question_prefix: "Вопрос: {question}\n\nКонтекст:\n"
  
  # Сообщения для fallback
  fallback_messages:
    documents_list: |
      В проекте '{project_name}' загружены следующие документы:

      {doc_list}

      Документы могут быть еще в процессе обработки. Попробуйте задать вопрос о конкретном документе по его названию.
  
  # Контекст для prompt builder
  context:
    no_chunks: "Контекст из документов отсутствует. Отвечай на основе своих знаний, но учитывай настройки проекта."
    summaries_prefix: "Краткие содержания документов:\n\n"
    summaries_suffix: "\n\nИспользуй эту информацию для ответа на вопрос."
    metadata_prefix: "Метаданные загруженных документов (документы могут еще обрабатываться):\n\n"
    metadata_instruction: |
      ВАЖНО: Используй эту информацию для ответа на вопрос пользователя. 
      - Если вопрос касается конкретных файлов (например, "что в файле X.pdf"), используй названия файлов из метаданных
      - Если вопрос о ключевых словах или темах, используй ключевые слова из метаданных
      - Если вопрос о содержании документов, можешь ответить на основе названий файлов и ключевых слов
      - Если информации недостаточно, укажи, что документы еще обрабатываются, но можешь дать ответ на основе доступных метаданных
    additional_metadata: "\n\nДополнительная информация о документах проекта:\n{metadata_context}\n\nИспользуй эту информацию для более полного ответа."

# Настройки по умолчанию
defaults:
  # Лимиты
  top_k: 5
  top_k_fast: 3
  conversation_history_limit: 10
  conversation_history_limit_short: 6
  document_preview_length: 500
  document_max_length: 12000
  document_chunk_size: 1000
  document_chunk_overlap: 500
  max_tokens_fast: 200
  max_tokens_default: 1000
  
  # Пороги
  similarity_threshold: 0.5
  late_chunking_threshold: 0.3
  best_score_threshold: 0.3
  
  # Температура
  temperature_default: 0.7
  temperature_questions: 0.8

